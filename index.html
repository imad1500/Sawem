
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sawem Shop</title>
  <meta name="description" content="Sawem Shop - Produits tech et √©lectroniques">
  <meta name="verify-admitad" content="5ae23ad5f3" />

  <!-- Preconnect -->
  <link rel="preconnect" href="https://sawem-backend.onrender.com">
  <link rel="preconnect" href="https://api.jina.ai">
  <link rel="dns-prefetch" href="//ui-avatars.com">
  <link rel="icon" type="image/png" href="Images/icone_Sawem.shop.png" />

  <!-- CSS -->
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- ==================== HEADER ==================== -->
  <header>
    <div class="container header-container">
      <div class="header-left">
        <h1>Sawem.shop</h1>
        <span class="cart">üõí</span>
      </div>
      <div class="header-right">
        <div id="authStatus" class="auth-status loading">‚è≥ V√©rification...</div>
        <div id="userInfo" class="user-info" style="display:none;">
          <img id="userAvatar" class="user-avatar" src="" alt="Avatar" width="32" height="32" loading="lazy"/>
          <div class="user-details">
            <div id="userName" class="user-name"></div>
            <div id="userEmail" class="user-email"></div>
          </div>
          <button id="logoutBtn" class="logout-btn" type="button">D√©connexion</button>
        </div>
        <a id="adminLink" class="admin-link" href="/admin.html" style="display:none;">üîß Administration</a>
        <a id="googleLoginBtn" class="google-btn" href="#" style="display:none;">Se connecter avec Google</a>
      </div>
    </div>
  </header>

  <!-- ==================== NOTIFICATION ==================== -->
  <div id="notification" class="notification" role="alert" aria-live="polite"></div>

  <!-- ==================== MAIN ==================== -->
  <main class="container">

    <!-- ===== RECHERCHE & FILTRES ===== -->
    <section class="search-section">
      <h2 class="section-title">Recherche & Filtres</h2>

      <!-- Barre de recherche principale -->
      <div class="search-container">
        <input type="text" id="searchInput" placeholder="Rechercher des produits..." class="search-input">
        <div class="search-buttons">
          <button id="textSearchBtn" class="search-btn text-search" title="Recherche textuelle rapide">
            üîç Recherche
          </button>
          <button id="aiSearchBtn" class="search-btn ai-search" title="Recherche IA intelligente">
            ü§ñ Recherche IA
          </button>
        </div>
      </div>

      <!-- Cat√©gories -->
      <div class="categories-section">
        <h2>üîç Recherche par cat√©gorie</h2>
        <div class="categories-grid">
          <button class="category-btn" data-search="smartphones">üì± Smartphones</button>
          <button class="category-btn" data-search="laptops">üíª Laptops</button>
          <button class="category-btn" data-search="casques audio">üéß Casques Audio</button>
          <button class="category-btn" data-search="montres connect√©es">‚åö Montres Connect√©es</button>
          <button class="category-btn" data-search="tablettes">üì± Tablettes</button>
          <button class="category-btn" data-search="appareils photo">üì∏ Appareils Photo</button>
          <button class="category-btn" data-search="gaming">üéÆ Gaming</button>
          <button class="category-btn" data-search="drones">üöÅ Drones</button>
          <button class="category-btn" data-search="enceintes">üîä Enceintes</button>
          <button class="category-btn" data-search="claviers">‚å®Ô∏è Claviers</button>
          <button class="category-btn" data-search="souris">üñ±Ô∏è Souris</button>
          <button class="category-btn" data-search="√©crans">üñ•Ô∏è √âcrans</button>
        </div>
      </div>

      <!-- Filtres avanc√©s -->
      <div class="filters-container">
        <div class="filter-group">
          <label for="sourceFilter">Source :</label>
          <select id="sourceFilter" class="filter-select">
            <option value="">Toutes les sources</option>
            <option value="aliexpress">AliExpress</option>
            <option value="amazon">Amazon</option>
            <option value="other">Autres</option>
          </select>
        </div>

        <div class="filter-group price-filter-group">
          <label for="priceRange">Gamme de prix :</label>
          <div class="price-range-container">
            <input type="range" id="priceMinRange" class="price-slider" min="0" max="1000" value="0" step="10">
            <input type="range" id="priceMaxRange" class="price-slider" min="0" max="1000" value="1000" step="10">
            <div class="price-display">
              <span id="priceMinDisplay">0‚Ç¨</span> - <span id="priceMaxDisplay">1000‚Ç¨+</span>
            </div>
          </div>
        </div>

        <div class="filter-group">
          <label for="sortBy">Trier par :</label>
          <select id="sortBy" class="filter-select">
            <option value="relevance">Pertinence</option>
            <option value="price_asc">Prix croissant</option>
            <option value="price_desc">Prix d√©croissant</option>
            <option value="rating_desc">Meilleures notes</option>
            <option value="newest">Plus r√©cents</option>
          </select>
        </div>

        <button id="clearFiltersBtn" class="clear-filters-btn">üóëÔ∏è R√©initialiser les filtres</button>
      </div>
    </section>

    <!-- ===== MESSAGE DE BIENVENUE ===== -->
    <div id="welcomeMessage" class="welcome-message" style="display:none;">
      <h3>Bienvenue <span id="welcomeUserName"></span> ! üëã</h3>
      <p>Vous pouvez maintenant voter et laisser des avis sur les produits.</p>
    </div>

    <!-- ===== STATISTIQUES (remplac√©) ===== -->
    <div id="searchStats" class="search-stats" style="display: none;">
      <div class="search-results-info">
        <span id="resultsCount">0 r√©sultats</span>
        <span id="searchQuery"></span>
      </div>
    </div>

    <!-- ===== PRODUITS ===== -->
    <div id="productsContainer" class="products-container">
      <div class="loading-skeleton">
        <div class="skeleton-card"></div>
        <div class="skeleton-card"></div>
        <div class="skeleton-card"></div>
        <div class="skeleton-card"></div>
        <div class="skeleton-card"></div>
        <div class="skeleton-card"></div>
      </div>
    </div>

    <!-- ===== PAGINATION ===== -->
    <div id="pagination" class="pagination" style="display:none;">
      <button id="prevPageBtn" class="page-btn">‚Üê Pr√©c√©dent</button>
      <span id="pageInfo" class="page-info">Page 1</span>
      <button id="nextPageBtn" class="page-btn">Suivant ‚Üí</button>
    </div>

  </main>

  <!-- ==================== FOOTER ==================== -->
  <footer>
    <div class="container">
      <p>&copy; 2025 Sawem.shop - Tous droits r√©serv√©s. | +33 7 45 43 87 28 | 
      <a href="mailto:imadbelkaceminfo@gmail.com">imadbelkaceminfo@gmail.com</a></p>
    </div>
  </footer>

  <!-- ==================== SCRIPTS ==================== -->
  <script>
const BACKEND_URL = "https://sawem-backend.onrender.com";
let currentUser = null;
let authToken = null;

// Auth functions
function getToken() { 
  if (!authToken) authToken = localStorage.getItem('sawem_auth_token');
  return authToken; 
}

function getAuthHeaders() { 
  const token = getToken(); 
  return token ? {'Authorization': `Bearer ${token}`, 'Content-Type': 'application/json'} : {'Content-Type': 'application/json'}; 
}

// Display products function
function displayProducts(products) {
  const container = document.getElementById('productsContainer');
  if (!products || products.length === 0) {
    container.innerHTML = '<div class="no-products">Aucun produit trouv√©</div>';
    return;
  }
  
  let html = '';
  products.forEach(product => {
    html += `
      <div class="product-card">
        <img src="${product.image}" alt="${product.title}" />
        <div class="product-info">
          <h3>${product.title}</h3>
          <p class="price">${product.price}</p>
          <p class="rating">‚≠ê ${product.user_rating || 0}/5</p>
          <a href="${product.link}" target="_blank" class="view-btn">Voir le produit</a>
        </div>
      </div>
    `;
  });
  container.innerHTML = `<div class="product-grid">${html}</div>`;
}

// Load products
async function loadProducts() {
  try {
    const res = await fetch(`${BACKEND_URL}/products`, { 
      headers: getAuthHeaders() 
    });
    
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    
    const products = await res.json();
    displayProducts(products);
  } catch (err) {
    console.error('Load products error:', err);
    document.getElementById('productsContainer').innerHTML = '<p>Erreur de chargement des produits</p>';
  }
}

// Search functions  
async function performTextSearch(query) {
  if (!query) { 
    loadProducts(); 
    return; 
  }
  
  try {
    const res = await fetch(`${BACKEND_URL}/search`, {
      method: 'POST',
      headers: getAuthHeaders(),
      body: JSON.stringify({ query: query.trim(), type: 'text' })
    });
    
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    
    const products = await res.json();
    displayProducts(products);
    
    // Update stats
    document.getElementById('resultsCount').textContent = `${products.length} r√©sultats`;
    document.getElementById('searchQuery').textContent = `pour "${query}"`;
    document.getElementById('searchStats').style.display = 'block';
  } catch (err) {
    console.error('Text search error:', err);
    document.getElementById('productsContainer').innerHTML = '<p>Erreur de recherche</p>';
  }
}

async function performAISearch(query) {
  if (!query) return;
  
  try {
    const res = await fetch(`${BACKEND_URL}/search`, {
      method: 'POST', 
      headers: getAuthHeaders(),
      body: JSON.stringify({ query: query.trim(), type: 'ai' })
    });
    
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    
    const products = await res.json();
    displayProducts(products);
  } catch (err) {
    console.error('AI search error:', err);
    // Fallback to text search
    performTextSearch(query);
  }
}

// Check user auth
async function checkUser() {
  try {
    // Check URL for token
    const urlParams = new URLSearchParams(window.location.search);
    const urlToken = urlParams.get('token');
    if (urlToken) {
      localStorage.setItem('sawem_auth_token', urlToken);
      authToken = urlToken;
      window.history.replaceState({}, document.title, window.location.pathname);
    }
    
    const token = getToken();
    if (!token) return;
    
    const res = await fetch(`${BACKEND_URL}/verify-token`, {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({token})
    });
    
    if (!res.ok) throw new Error('Token invalid');
    
    const data = await res.json();
    if (data.success && data.user) {
      currentUser = data.user;
      
      // Update UI
      document.getElementById('authStatus').style.display = 'none';
      document.getElementById('googleLoginBtn').style.display = 'none';
      document.getElementById('welcomeUserName').textContent = data.user.name;
      document.getElementById('welcomeMessage').style.display = 'block';
      
      // Show admin link if admin
      if (data.user.role === 'admin') {
        document.getElementById('adminLink').style.display = 'flex';
      }
    }
  } catch (err) {
    console.error('Auth error:', err);
    authToken = null;
    localStorage.removeItem('sawem_auth_token');
  }
}

// Event listeners
document.addEventListener('DOMContentLoaded', () => {
  checkUser();
  loadProducts();
  
  // Search buttons
  document.getElementById('textSearchBtn').addEventListener('click', () => {
    const query = document.getElementById('searchInput').value.trim();
    performTextSearch(query);
  });
  
  document.getElementById('aiSearchBtn').addEventListener('click', () => {
    const query = document.getElementById('searchInput').value.trim();
    performAISearch(query);
  });
  
  // Category buttons
  document.querySelectorAll('.category-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const query = btn.dataset.search;
      document.getElementById('searchInput').value = query;
      performTextSearch(query);
    });
  });
});
</script>

</body>
</html>

